package com.ccp.service;

import java.io.OutputStream;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.io.IOUtils;

import com.ccp.dao.MnDataDao;
import com.ccp.pojo.MnData;

public class MnDataService {
	private MnDataDao dao;

	public void setDao(MnDataDao dao) {
		this.dao = dao;
	}

	public List<String> getMnDataLineList(String enterpriseName) {
		List<String> list = new ArrayList<String>();
		List<String> deviceNameList = dao
				.getDeviceNameListByEnterpriseName(enterpriseName);
		for (String deviceName : deviceNameList) {
			List<MnData> mnDatalist = dao
					.getMnDataListByEnterpriseNameAndDeviceName(enterpriseName,
							deviceName);
			list.add(generateDataLine(deviceName, mnDatalist));
		}
		return list;
	}

	public String generateDataLine(String deviceName, List<MnData> mnDatalist) {
		final String DEVICENAME1="DFR-2期焚烧炉";
		final String DEVICENAME2="DFR-1期焚烧炉";
		final String DEVICENAME3="DFR-1、2期溢散水洗塔";
		final String DEVICENAME4="DFR3期溢散水洗塔";
		final String DEVICENAME5="DFR3期焚烧炉（西）";
		final String DEVICENAME6="DFR3期焚烧炉（4线 东）";
		final String DEVICENAME7="厂界1";
		final String DEVICENAME8="厂界2";
		final String DEVICENAME9="厂界3";
		final String DEVICENAME10="厂界4";
		final String DEVICENAME11="BPA2（VOCs+甲硫醇）";
		final String DEVICENAME12="氧化炉（VOCs+H2S）";
		final String DEVICENAME13="PN（VOCs+甲硫醇）";

		final String POLLUTION1="甲烷";
		final String POLLUTION2="非甲烷总烃";
		final String POLLUTION3="总烃";
		final String DEVICECODE1="Root.CN.CCJS_ENVIRON.VOCS.DFR2";
		final String DEVICECODE2="Root.CN.CCJS_ENVIRON.VOCS.DFR1";
		final String DEVICECODE3="Root.CN.CCJS_ENVIRON.VOCS.DFRWT1/2";
		final String DEVICECODE4="Root.CN.CCJS_ENVIRON.VOCS.DFRWT3/4";
		final String DEVICECODE5="Root.CN.CCJS_ENVIRON.VOCS.DFR3W";
		final String DEVICECODE6="Root.CN.CCJS_ENVIRON.VOCS.DFR3E";
		final String DEVICECODE7="Root.CN.CCJS_ENVIRON.VOCS.PN";
		final String DEVICECODE9="";
		final String DEVICECODE10="";
		final String DEVICECODE11="Root.CN.CCJS_ENVIRON.VOCS.BPA2";
		final String DEVICECODE12="";
		final String DEVICECODE13="";
		final String DEVICECODE1="";
		
		StringBuilder sb = new StringBuilder("TAGNAME=");

		Timestamp time = null;
		for (MnData mnData : mnDatalist) {
			
		if (deviceName.equals(DEVICENAME1)) {
			sb.append(DEVICECODE1);
		}else if (deviceName.equals(DEVICENAME2)) {
			
		}else if (deviceName.equals(DEVICENAME3)) {
			
		}else if (deviceName.equals(DEVICENAME4)) {
			
		}else if (deviceName.equals(DEVICENAME5)) {
			
		}else if (deviceName.equals(DEVICENAME6)) {
			
		}

			sb.append(",").append(mnData.getPollutantName()).append("=")
					.append(mnData.getRealtimeData());
			time=mnData.getMeasureDatetime();
		
			}
		sb.append(",TIME=").append(time);
        
		return sb.toString();
	}

	public void mnDataToFile(List<String> mnDataLineList, OutputStream output)
			throws Exception {
		IOUtils.writeLines(mnDataLineList, IOUtils.LINE_SEPARATOR, output,
				"utf-8");
		IOUtils.closeQuietly(output);
	}

}
