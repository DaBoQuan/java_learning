MainPanel=function(j,b){var c=new Ext.menu.ColorMenu({items:[{text:"None",handler:function(){j.setCellStyles(mxConstants.STYLE_FILLCOLOR,mxConstants.NONE)}},"-"],handler:function(m,n){if(typeof(n)=="string"){j.setCellStyles(mxConstants.STYLE_FILLCOLOR,"#"+n)}}});var d=new Ext.menu.ColorMenu({items:[{text:"None",handler:function(){j.setCellStyles(mxConstants.STYLE_FONTCOLOR,mxConstants.NONE)}},"-"],handler:function(m,n){if(typeof(n)=="string"){j.setCellStyles(mxConstants.STYLE_FONTCOLOR,"#"+n)}}});var i=new Ext.menu.ColorMenu({items:[{text:"None",handler:function(){j.setCellStyles(mxConstants.STYLE_STROKECOLOR,mxConstants.NONE)}},"-"],handler:function(m,n){if(typeof(n)=="string"){j.setCellStyles(mxConstants.STYLE_STROKECOLOR,"#"+n)}}});var g=new Ext.menu.ColorMenu({items:[{text:"None",handler:function(){j.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,mxConstants.NONE)}},"-"],handler:function(m,n){if(typeof(n)=="string"){j.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"#"+n)}}});var f=new Ext.menu.ColorMenu({items:[{text:"None",handler:function(){j.setCellStyles(mxConstants.STYLE_LABEL_BORDERCOLOR,mxConstants.NONE)}},"-"],handler:function(m,n){if(typeof(n)=="string"){j.setCellStyles(mxConstants.STYLE_LABEL_BORDERCOLOR,"#"+n)}}});var h=new Ext.data.SimpleStore({fields:["label","font"],data:[["Helvetica","Helvetica"],["Verdana","Verdana"],["Times New Roman","Times New Roman"],["Garamond","Garamond"],["Courier New","Courier New"]]});var e=new Ext.form.ComboBox({store:h,displayField:"label",mode:"local",width:120,triggerAction:"all",emptyText:"字体...",onSelect:function(m){if(m!=null){j.setCellStyles(mxConstants.STYLE_FONTFAMILY,m.data.font);this.collapse()}}});e.on("specialkey",function(o,m){if(m.keyCode==10||m.keyCode==13){var n=o.getValue();if(n!=null&&n.length>0){j.setCellStyles(mxConstants.STYLE_FONTFAMILY,n)}}});var l=new Ext.data.SimpleStore({fields:["label","size"],data:[["6pt",6],["8pt",8],["9pt",9],["10pt",10],["12pt",12],["14pt",14],["18pt",18],["24pt",24],["30pt",30],["36pt",36],["48pt",48],["60pt",60]]});var a=new Ext.form.ComboBox({store:l,displayField:"label",mode:"local",width:50,triggerAction:"all",emptyText:"12pt",selectOnFocus:true,onSelect:function(m){if(m!=null){j.setCellStyles(mxConstants.STYLE_FONTSIZE,m.data.size);this.collapse()}}});a.on("specialkey",function(o,m){if(m.keyCode==10||m.keyCode==13){var n=parseInt(o.getValue());if(!isNaN(n)&&n>0){j.setCellStyles(mxConstants.STYLE_FONTSIZE,n)}}});this.graphPanel=new Ext.Panel({region:"center",border:false,tbar:[{text:"",iconCls:"save-icon",tooltip:"保存",handler:function(){var m=new mxCodec(mxUtils.createXmlDocument());var n=m.encode(j.getModel());save(mxUtils.getPrettyXml(n))},scope:this},{text:"",iconCls:"erase-icon",tooltip:"擦除",handler:function(){erase()},scope:this},{text:"",iconCls:"reload-icon",tooltip:"重新载入",handler:function(){reload()},scope:this},"-",{id:"print",text:"",iconCls:"print-icon",tooltip:"打印",handler:function(){mxUtils.print(j)},scope:this},{id:"preview",text:"",iconCls:"preview-icon",tooltip:"预览",handler:function(){mxUtils.show(j)},scope:this},"-",{id:"cut",text:"",iconCls:"cut-icon",tooltip:"剪切",handler:function(){mxClipboard.cut(j)},scope:this},{id:"copy",text:"",iconCls:"copy-icon",tooltip:"复制",handler:function(){mxClipboard.copy(j)},scope:this},{text:"",iconCls:"paste-icon",tooltip:"粘贴",handler:function(){mxClipboard.paste(j)},scope:this},"-",{id:"delete",text:"",iconCls:"delete-icon",tooltip:"删除",handler:function(){j.remove(null)},scope:this},"-",{id:"undo",text:"",iconCls:"undo-icon",tooltip:"撤销",handler:function(){b.undo();updateGrid(j)},scope:this},{id:"redo",text:"",iconCls:"redo-icon",tooltip:"恢复",handler:function(){b.redo();updateGrid(j)},scope:this},"-",e," ",a,"-",{id:"bold",text:"",iconCls:"bold-icon",tooltip:"加粗",handler:function(){j.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)},scope:this},{id:"italic",text:"",tooltip:"倾斜",iconCls:"italic-icon",handler:function(){j.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)},scope:this},{id:"underline",text:"",tooltip:"下划线",iconCls:"underline-icon",handler:function(){j.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE)},scope:this},"-",{id:"fontcolor",text:"",tooltip:"字体颜色",iconCls:"fontcolor-icon",menu:d},{id:"linecolor",text:"",tooltip:"线条颜色",iconCls:"linecolor-icon",menu:i},{id:"fillcolor",text:"",tooltip:"图形颜色",iconCls:"fillcolor-icon",menu:c},"-",{id:"alignleft",text:"",iconCls:"left-icon",tooltip:"横向对齐",handler:function(){j.alignCells(mxConstants.ALIGN_LEFT)}},{id:"aligntop",text:"",iconCls:"top-icon",tooltip:"纵向对齐",handler:function(){j.alignCells(mxConstants.ALIGN_TOP)}},"-",{text:"",iconCls:"zoomin-icon",tooltip:"放大",scope:this,handler:function(m){j.zoomIn()}},{text:"",iconCls:"zoomout-icon",tooltip:"缩小",scope:this,handler:function(m){j.zoomOut()}},{text:"",iconCls:"zoomactual-icon",tooltip:"实际大小",scope:this,handler:function(m){j.zoomActual()}},{text:"",iconCls:"diagram-icon",tooltip:"还原指定的版本",handler:function(){reductionGraphVersion()},scope:this}],onContextMenu:function(n,o){var m=!j.isSelectionEmpty();if(!m){return}if(m){if((n.vertex&&n.style&&n.vertex==1&&(typeof(n.style)=="undefined"||n.style.indexOf("rounded")>-1))||(n.edge&&(typeof(n.style)=="undefined"||n.style)&&n.edge==1&&(typeof(n.style)=="undefined"||n.style.indexOf("line")==-1))){}else{m=false}}var p=true;if(n.vertex&&n.style&&n.vertex==1&&(typeof(n.style)=="undefined"||n.style.indexOf("rounded")>-1)){if(n.id.length==32){p=false}}this.menu=new Ext.menu.Menu({id:"feeds-ctx",items:[{text:"剪切",iconCls:"cut-icon",disabled:!m,scope:this,handler:function(){mxClipboard.cut(j)}},{text:"复制",iconCls:"copy-icon",disabled:!m,scope:this,handler:function(){mxClipboard.copy(j)}},{text:"粘贴",iconCls:"paste-icon",disabled:mxClipboard.isEmpty(),scope:this,handler:function(){mxClipboard.paste(j)}},"-",{text:"节点操作者",iconCls:"op-icon",disabled:p,scope:this,handler:function(){addOperator(n.id)}},"-",{text:"删除",iconCls:"delete-icon",disabled:!m,scope:this,handler:function(){j.remove(null)}}]});this.menu.on("hide",this.onContextHide,this);if(m){this.menu.showAt([o.clientX,o.clientY])}},onContextHide:function(){if(this.ctxNode){this.ctxNode.ui.removeClass("x-node-ctx");this.ctxNode=null}}});MainPanel.superclass.constructor.call(this,{region:"center",layout:"fit",items:this.graphPanel});var k=this;j.panningHandler.popup=function(n,p,m,o){k.graphPanel.onContextMenu(m,o)};j.panningHandler.hideMenu=function(){if(k.graphPanel.menuPanel!=null){k.graphPanel.menuPanel.hide()}};this.graphPanel.on("resize",function(){j.sizeDidChange()})};Ext.extend(MainPanel,Ext.Panel,{movePreview:function(a,b){}});