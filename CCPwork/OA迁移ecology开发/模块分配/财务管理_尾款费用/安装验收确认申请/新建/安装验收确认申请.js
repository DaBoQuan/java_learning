<CENTER>
<DIV id=layoutDiv>
<TABLE class=layouttable border=1>
<CAPTION>安装验收确认申请（新建）</CAPTION>
<COLGROUP>
<COL width="12%">
<COL width="38%">
<COL width="12%">
<COL width="38%"></COLGROUP>
<TBODY>
<TR>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c202ca1f006c0 name=MultiLanguageLabel>标题</A></TD>
<TD class=FieldValue colSpan=3><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c202ca1f006c0$ class=InputStyle2 value=[可编辑]安装验收确认主表.标题 name=40285a8d4c1ff2fe014c200b95640216></TD></TR>
<TR>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_申请单号 name=MultiLanguageLabel>申请单号</A></TD>
<TD class=FieldValue colSpan=3><INPUT style="WIDTH: 80%" id=$申请单号$ class=InputStyle2 value=[可编辑]安装验收确认主表.申请单号 name=40285a8d4c1ff2fe014c200b95640216></TD></TR>
<TR>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_公司代码 name=MultiLanguageLabel>公司代码</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$公司代码$ class=InputStyle2 value=[可编辑]安装验收确认主表.公司代码 name=40285a8d4c1ff2fe014c200b95640216></TD>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_填单日期 name=MultiLanguageLabel>填单日期</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$填单日期$ class=InputStyle2 value=[可编辑]安装验收确认主表.填单日期 name=40285a8d4c1ff2fe014c200b95640216></TD></TR>
<TR>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_承办人 name=MultiLanguageLabel>承办人</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$承办人$ class=InputStyle2 value=[可编辑]安装验收确认主表.承办人 name=40285a8d4c1ff2fe014c200b95640216></TD>
<TD class=FieldName noWrap>制程</TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c202ca32406ca$ class=InputStyle2 value=[可编辑]安装验收确认主表.验收单位 name=40285a8d4c1ff2fe014c200b95640216></TD></TR>
<TR>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_供应商简码 name=MultiLanguageLabel>供应商简码</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$供应商简码$ class=InputStyle2 value=[可编辑]安装验收确认主表.供应商简码 name=40285a8d4c1ff2fe014c200b95640216></TD>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_供应商名称 name=MultiLanguageLabel>供应商名称</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$供应商名称$ class=InputStyle2 value=[可编辑]安装验收确认主表.供应商名称 name=40285a8d4c1ff2fe014c200b95640216></TD></TR>
<TR>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_采购订单 name=MultiLanguageLabel>采购订单</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 49.11%; HEIGHT: 19px" id=$采购订单$ class=InputStyle2 value=[必须输入]安装验收确认主表.采购订单 size=1 name=40285a8d4c1ff2fe014c200b95640216><INPUT onclick=getsupplyinfo() value=获取信息 type=button></TD>
//button on click 事件
<TD class=FieldName noWrap><A id=MultiLanguageLabel_采购员 name=MultiLanguageLabel>采购员</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 22.58%; HEIGHT: 24px" id=$采购员$ class=InputStyle2 value=[可编辑]安装验收确认主表.采购员 size=1 name=40285a8d4c1ff2fe014c200b95640216><INPUT style="WIDTH: 120px; HEIGHT: 23px" id=$40285a8d52f37b040152f3ab0dc00054$ class=InputStyle2 value=[隐藏]安装验收确认主表.采购人员 size=6 name=40285a8d4c1ff2fe014c200b95640216></TD></TR>
<TR>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_签核状态 name=MultiLanguageLabel>签核状态</A></TD>
<TD class=FieldValue colSpan=3><INPUT style="WIDTH: 34.04%; HEIGHT: 19px" id=$签核状态$ class=InputStyle2 value=[只读]安装验收确认主表.签核状态 size=1 name=40285a8d4c1ff2fe014c200b95640216></TD></TR><TRSTYLE=DISPLAY: none>
<TR style="DISPLAY: none">
<TD class=FieldName noWrap><A id=MultiLanguageLabel_付款条件 name=MultiLanguageLabel>付款条件</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$付款条件$ class=InputStyle2 value=[只读]安装验收确认主表.付款条件 name=40285a8d4c1ff2fe014c200b95640216></TD>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_剩余期数 name=MultiLanguageLabel>剩余期数</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80.2%; HEIGHT: 19px" id=$剩余期数$ class=InputStyle2 value=[只读]安装验收确认主表.剩余期数 size=16 name=40285a8d4c1ff2fe014c200b95640216></TD></TR>
<TR style="DISPLAY: none">
<TD class=FieldName noWrap><A id=MultiLanguageLabel_审核日期 name=MultiLanguageLabel>审核日期</A><A id=MultiLanguageLabel_审核日期 name=MultiLanguageLabel></A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$审核日期$ class=InputStyle2 value=[可编辑]安装验收确认主表.审核日期 name=40285a8d4c1ff2fe014c200b95640216></TD>
<TD class=FieldName></TD>
<TD class=FieldValue></TD></TR></TBODY></TABLE>
<TABLE id=oTable40285a8d4c1ff2fe014c2045dfda0814 class=detailtable border=1>
<CAPTION>
<P>采购订单信息<SPAN id=div40285a8d4c1ff2fe014c2045dfda0814button name="div40285a8d4c1ff2fe014c2045dfda0814button"><A href="javascript:addrow('40285a8d4c1ff2fe014c2045dfda0814');"><IMG title=New border=0 src="/images/plus.gif" width=11 height=11></A>&nbsp;<A href="javascript:delrow('40285a8d4c1ff2fe014c2045dfda0814');"><IMG title=Delete border=0 src="/images/minus.gif" width=11 height=11></A>&nbsp;<A href="javascript:addrowbyexcel('40285a8d4c1ff2fe014c2045dfda0814');"><IMG title=Excel border=0 src="/images/excel.gif" width=11 height=11></A><INPUT onclick=javascript:getData(); value=获取订单行项目 type=button></SPAN></P></CAPTION>
<COLGROUP>
<COL width="11%">
<COL width="11%">
<COL width="11%">
<COL width="11%">
<COL width="11%">
<COL width="11%">
<COL width="11%">
<COL width="11%">
<COL width="11%"></COLGROUP>
<TBODY>
<TR class=Header>
<TD noWrap><INPUT id=check_node_all onclick="selectAll(this,'40285a8d4c1ff2fe014c2045dfda0814')" value=-1 type=checkbox name=check_node_all><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d659099e name=MultiLanguageLabel>采购订单号</A></TD>
<TD noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d67d09a0 name=MultiLanguageLabel>项次</A></TD>
<TD noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d6a109a2 name=MultiLanguageLabel>短文本</A></TD>
<TD noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d6c409a4 name=MultiLanguageLabel>订购单位</A></TD>
<TD noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d6e909a6 name=MultiLanguageLabel>采购订单数量</A></TD>
<TD noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d70d09a8 name=MultiLanguageLabel>金额（完税）</A></TD>
<TD noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d73309aa name=MultiLanguageLabel>货币</A></TD>
<TD noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d75709ac name=MultiLanguageLabel>付款比例</A></TD>
<TD noWrap><A id=MultiLanguageLabel_40285a8d4c1ff2fe014c2063d77d09ae name=MultiLanguageLabel>付款金额</A></TD></TR>
<TR id=oTR40285a8d4c1ff2fe014c2045dfda0814 class=DataLight><!-- 明细表ID，请勿删除。-->
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d659099e$ class=InputStyle2 value=[只读]安装验收确认采购订单信息.采购订单号 name=40285a8d4c1ff2fe014c2045dfda0814></TD>
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d67d09a0$ class=InputStyle2 value=[可编辑]安装验收确认采购订单信息.项次 name=40285a8d4c1ff2fe014c2045dfda0814></TD>
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d6a109a2$ class=InputStyle2 value=[只读]安装验收确认采购订单信息.短文本 name=40285a8d4c1ff2fe014c2045dfda0814></TD>
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d6c409a4$ class=InputStyle2 value=[只读]安装验收确认采购订单信息.订购单位 name=40285a8d4c1ff2fe014c2045dfda0814></TD>
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d6e909a6$ class=InputStyle2 value=[只读]安装验收确认采购订单信息.采购订单数量 name=40285a8d4c1ff2fe014c2045dfda0814></TD>
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d70d09a8$ class=InputStyle2 value=[只读]安装验收确认采购订单信息.金额（完税） name=40285a8d4c1ff2fe014c2045dfda0814></TD>
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d73309aa$ class=InputStyle2 value=[只读]安装验收确认采购订单信息.货币 name=40285a8d4c1ff2fe014c2045dfda0814></TD>
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d75709ac$ class=InputStyle2 value=[只读]安装验收确认采购订单信息.付款比例 name=40285a8d4c1ff2fe014c2045dfda0814></TD>
<TD noWrap><INPUT style="WIDTH: 80%" id=$40285a8d4c1ff2fe014c2063d77d09ae$ class=InputStyle2 value=[只读]安装验收确认采购订单信息.付款金额 name=40285a8d4c1ff2fe014c2045dfda0814></TD></TR></TBODY></TABLE>
<TABLE class=layouttable border=1>
<COLGROUP>
<COL width="12%">
<COL width="38%">
<COL width="12%">
<COL width="38%"></COLGROUP>
<TBODY>
<TR>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_总付款金额 name=MultiLanguageLabel></A></TD>
<TD class=FieldValue></TD>
<TD class=FieldName noWrap><A id=MultiLanguageLabel_总付款金额 name=MultiLanguageLabel>总付款金额</A></TD>
<TD class=FieldValue><INPUT style="WIDTH: 80%" id=$总付款金额$ class=InputStyle2 value=[只读]安装验收确认主表.采购订单总付款金额 name=40285a8d4c1ff2fe014c200b95640216></TD></TR></TBODY></TABLE></DIV></CENTER>




<SCRIPT>    
	WeaverUtil.load(function(){  
		getcheck();  
		ordernum(); 
		//getobj();
	});  
	function getData()     
	{     
		DWREngine.setAsync(false);      
		if(requestid)     
		{     
		//onSubmit(1);      
		var orderno=document.getElementById('field_采购订单').value;//订单编号     
		//alert(orderno);     
		Ext.Ajax.request({        
				url: '/app/weikuan/checkgetrowinfo.jsp?action=getData',                       
				params:{requestid:requestid,orderno:orderno},                                                      
				success: function(res){               
				jsonResult = eval('('+res.responseText+')');                
				}      
		});      
		alert('请刷新！');   
	}     
	else     
	{     
		alert('请先保存数据！');        
	}     
	   
	DWREngine.setAsync(true);      

	}    

	function getsupplyinfo()     
	{     
	DWREngine.setAsync(false); 
	//alert(11312312312312);  
	var purchno=document.getElementById('field_采购订单').value;//订单编号
	alert('获取供应商信息');      
		Ext.Ajax.request({                                                             
			url: '/app/weikuan/getsupplyinfo.jsp',                                                                   
			params:{requestid:requestid,purchno:purchno},                                                                    
			success: function(res) {         
			jsonResult = eval('('+res.responseText+')');        
			//alert(jsonResult .LIFNR);    
			document.getElementById('field_供应商简码').value=jsonResult .LIFNR ;           //供应商简码         
			document.getElementById('field_供应商简码span').innerHTML=jsonResult .LIFNR;          
			document.getElementById('field_供应商名称').value=jsonResult .NAME1 ;            //供应商名称         
			document.getElementById('field_供应商名称span').innerHTML=jsonResult .NAME1;         
			document.getElementById('field_付款条件').value=jsonResult .ZTERM;                                       
			document.getElementById('field_付款条件span').innerHTML=jsonResult .ZTERM;      
			var sql='update uf_fn_acceptconfirm set  suppliercode=\''+jsonResult .LIFNR +'\',payterm=\''+jsonResult .ZTERM+'\',suppliername=\''+jsonResult .NAME1 +'\'where requestid=\''+requestid+'\'';   
	 DataService.executeSql(sql,{callback:function(data){}});        
			}                                                                
		});
	    getcheck();          
		getsupplyinfo2();     
	 DWREngine.setAsync(true); 
	 }     


	function getsupplyinfo2()     
	{     
		var purchno=document.getElementById('field_采购订单').value;           //订单编号    
		if(purchno!=''){     
	alert('获取采购员');  
		Ext.Ajax.request({                                                                    
			 url: '/app/weikuan/getname.jsp',                                                                   
			 params:{requestid:requestid,purchno:purchno},                                                                    
			 success: function(res) {         
			 jsonResult = eval('('+res.responseText+')');                
			 document.getElementById('field_采购员').value=jsonResult .EKGRP; //采购员      
			 document.getElementById('field_采购员span').innerHTML=jsonResult .EKGRP;  
			
			 }                                                                   
		});  
	   }else{
			alert('请先输入采购订单号！');
			 document.getElementById('field_采购员').value='';                //采购组          
			 document.getElementById('field_采购员span').innerHTML='';  

	   }
		 
	}     

	function getcheck(){  
		var payterm=document.getElementById('field_付款条件').value 
		var sql='select residuenum from uf_fn_installmentdata  where code=\''+payterm+'\'';  
		 DataService.getValues(sql,{        
			callback:function(data)           
			{            
			 if(data&&data.length>0){ 
				 for (var i=0;i<data.length ; i++) {
					 var sql2='update uf_fn_acceptconfirm set  residue=\''+data[0].residuenum+'\' where requestid=\''+requestid+'\' ';                 
				 DataService.executeSql(sql2,{callback:function(data){}});   
	}     
			}               
			}         
		});   
		
	} 



	function onSubmitBefore(issave)      
	{      
		if(issave==1)//保存      
		{      
			return true;      
		}      
		else      
		{      
	DWREngine.setAsync(false);    

			var payterm=document.getElementById('field_付款条件').value;	//付款条件      
			var renum=document.getElementById('field_剩余期数').value;	//剩余期数      
			//alert(renum);   

			if(renum=='40285a8d4bd90cff014bdea1e07c775c')      //sleectitem objname=2  selecttype 剩余期数
			{     

				var length=0;        
				var sql='select * from uf_fn_acceptorder    where requestid=\''+requestid+'\''              
				DataService.getValues(sql,{              
					callback:function(data)              
					{         
					// alert(data.length);        
					 if(data&&data.length>0)        
						 {    
							length=data.length;    
						 }                  
					}            
				});        

				if(length==0)     
				{     
					alert('未获取采购订单！');  
					return false;     
				}   
				else  
				{  
					return true;  
				}  
					  
			}      
			else      
			{      
				alert('订单不符合或无采购订单信息！');      
				document.getElementById('field_供应商简码').value='';//供应商简码      
				document.getElementById('field_供应商简码span').innerHTML='';      
				document.getElementById('field_供应商名称span').innerHTML='';//供应商名称      
				document.getElementById('field_供应商名称').value='';      
				document.getElementById('field_采购订单').value='';//采购订单      
				document.getElementById('field_采购订单span').innerHTML='';      
				document.getElementById('field_采购员').value='';//采购员      
				document.getElementById('field_采购员span').innerHTML='';      
				document.getElementById('field_付款条件').value='';//付款条件      
				document.getElementById('field_付款条件span').innerHTML='';      
				document.getElementById('field_剩余期数').value='';//剩余期数      
				document.getElementById('field_剩余期数span').innerHTML='';      
				//采购订单行项目      
				selectAll1('40285a8d4c1ff2fe014c2045dfda0814');      
				return false;      
			}      
	DWREngine.setAsync(true);   

		}      
	}  //删除所有行        
	function selectAll1 (tableid) {         
		var tbl=document.getElementById('oTable'+tableid).rows.length-1; //取得表格行数量            
		for( var i=0;i<tbl;i++)     //从第0行循环到最后一行     
		{          
			document.getElementsByName('check_node_'+tableid)[i].checked=true;        
		}        
		delrow(tableid); //删除所有行       
	}   

	function ordernum()   
	{   
	DWREngine.setAsync(false);   
		var money='';   
		var tbl=document.getElementById('oTable40285a8d4c1ff2fe014c2045dfda0814');   
		var len=tbl.rows.length-1;   
		var sql='select paytotal from uf_fn_acceptorder where requestid=\''+requestid+'\'' 

		DataService.getValues(sql,{            
			callback:function(data)            
			{          
			 if(data&&data.length>0){ 
				 for (var i=0;i<data.length ;i++ ) 
				 { 
					 money=money*1+data[i].paytotal*1; 
					  
				 } 
				 
			}                
			}          
		});  
	document.getElementById('field_总付款金额').value=money;
	document.getElementById('field_总付款金额span').innerHTML=money; 

	 DWREngine.setAsync(true);           
	} 


	/*
	function getobj() 
	{ 
		var tbl=document.getElementById('oTable40285a8d4c1ff2fe014c2045dfda0814');   
		var len=tbl.rows.length-1;   
		var rowno=''; 
		var ordernums='';  
		var money='';  
		var paytotal='';  

		var sql='select max(rowno)as rownos from uf_fn_acceptorder where requestid=\''+requestid+'\''; 
		   DataService.getValues(sql,{            
			callback:function(data)            
			{          
	alert(data.length);
			 if(data&&data.length>0){ 
				for ( var i=10;i<=data[0].rownos;i=i*1+10 ) 
				{   
	alert(i); 
					var sql1='select ordernum,money,paytotal from uf_fn_acceptorder where requestid=\''+requestid+'\' and rowno=\''+i+'\''; 
					DataService.getValues(sql1,{            
					callback:function(data1)            
					{          
	//alert(data.length); 
					 if(data1&&data1.length>0){ 
						 for (var j=0;j<data1.length ;j++ ) 
						 { 
							 ordernums=ordernums*1+data1[j].ordernum*1; 
	alert(ordernums); 
							 money=((data1[0].money*1)/ordernums)*data1[j].ordernum; 
	alert(money);  
							 paytotal=((data1[0].paytotal*1)/ordernums)*data1[j].ordernum; 
							 var sql2='update uf_fn_acceptorder set money=\''+money+'\',paytotal=\''+paymoney+'\' where requestid=\''+requestid+'\'and rowno=\''+i+'\' and ordernum=\''+ordernum[j]+'\'' ; 
							 DataService.executeSql(sql2,{callback:function(data){}}); 
	alert(sql2); 

						 } 
					}                
					}          
				}); 
				}          
			}                
			}          
		});  

	}*/

	function getjudge()  
	{  
	DWREngine.setAsync(false);    
		var orderno='';  
		var sql='select a.orderno from uf_fn_acceptconfirm a left join requestbase b on a.requestid=b.id  where isfinished=1';  
		DataService.getValues(sql,{       
			callback:function(data)       
			{     
			 if(data&&data.length>0){    
				 for (var i=0;i<data.length ; i++)   
				 {   
					orderno=data[i].orderno;  
		if (document.getElementById('field_采购订单').value==orderno)   
		{   
	alert('该采购订单已在流程内！');  
	document.getElementById('field_采购订单').value=''; 
		}   
	else{} 
				 }   
	   
			   }           
			}     
		});  
	DWREngine.setAsync(true);    

} 




</SCRIPT>
<INPUT id=$40285a8d519ddc7401519f86c1740003$ class=InputStyle2 value=[隐藏]安装验收确认主表.安装类型 name=40285a8d4c1ff2fe014c200b95640216><INPUT id=$40285a8d4c1ff2fe014c209f577c0dbb$ class=InputStyle2 value=[隐藏]安装验收确认主表.所属公司 name=40285a8d4c1ff2fe014c200b95640216><INPUT id=$40285a8d54317ae001545abf6fb50a63$ class=InputStyle2 value=[隐藏]安装验收确认主表.一级部门 name=40285a8d4c1ff2fe014c200b95640216><INPUT id=$40285a8d54317ae001545abf700c0a65$ class=InputStyle2 value=[隐藏]安装验收确认主表.二级部门 name=40285a8d4c1ff2fe014c200b95640216><INPUT id=$40285a8d54317ae001545ac6b2870b36$ class=InputStyle2 value=[隐藏]安装验收确认主表.当前环节 name=40285a8d4c1ff2fe014c200b95640216>